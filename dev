#!/bin/bash -eu
>&2 echo "For your convenience: 
  
    var s = document.createElement('script');
    s.src = 'http://localhost:29684/js/client-dev.js';
    document.body.appendChild(s);";
set -vx

cd "$(dirname $0)"

npm install --dev  .

cp client-src/blank.html dist/blank.html

(node_modules/.bin/babel \
    --stage 1 \
    --watch \
    --source-maps inline \
    client-src/ \
    --out-dir dist/)&

(node_modules/.bin/watchify \
    client-src/main.js \
    -t [ babelify --stage 1 ] \
    --debug \
    --outfile dist/client-dev.js)&

(babel-node server-src/main.js);

