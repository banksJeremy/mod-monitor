#!/bin/bash -eu
>&2 echo "For your convenience: 
  
    var s = document.createElement('script');
    s.src = 'http://localhost:29684/js/client-dev.js';
    document.body.appendChild(s);";
set -vx

cd "$(dirname $0)"

npm install --dev  .

rm -r dist/

mkdir -p dist/{html,js}

cp client-src/html/broadcaster.html dist/html/broadcaster.html

(node_modules/.bin/babel \
    --stage 1 \
    --watch \
    --source-maps inline \
    client-src/ \
    --out-dir dist/)&

(node_modules/.bin/watchify \
    client-src/js/main.js \
    -t [ babelify --stage 1 ] \
    --debug \
    --outfile dist/js/client-dev.js)&

(babel-node server-src/main.js);

